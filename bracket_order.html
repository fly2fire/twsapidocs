<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API v9.72: Bracket Orders</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
		var picked=getCookie("picked");
		if (picked != "") {
			if (!$(this).hasClass("active")) {
				var tabNum = $(this).index();
				var nthChild = picked;
				$("ul#tabs li.active").removeClass("active");
				$(this).addClass("active");
				$("ul#tab li.active").removeClass("active");
				$("ul#tab li:nth-child("+nthChild+")").addClass("active");
				$("ul#tabs li:nth-child("+nthChild+")").addClass("active");
				setCookie("picked", nthChild, 1);
			}
		}
		$("ul#tabs li").click(function(e){
			if (!$(this).hasClass("active")) {
			var tabNum = $(this).index();
			var nthChild = tabNum+1;
			$("ul#tabs li.active").removeClass("active");
			$(this).addClass("active");
			$("ul#tab li.active").removeClass("active");
			$("ul#tab li:nth-child("+nthChild+")").addClass("active");
			setCookie("picked", nthChild, 1);
		}
    });
});
function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires="+d.toUTCString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
} 
function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
} 
function checkCookie() {
    var picked=getCookie("picked");
    if (picked != "") {
        alert("Welcome again " + picked);
    }else{
        //username = prompt("Please enter your name:", "");
        if (picked != "" && picked != null) {
            setCookie("picked", 1, 365);
        }
    }
}
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0" >
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></a></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li></ul>
  </td>
  <td><a href="mailto:api@interactivebrokers.com?subject=TWS API Documentation" style="color:#C7C7C7;font-weight:bold;padding: 0 0 0 1em;">Contact us</a></td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('bracket_order.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bracket Orders </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://www.interactivebrokers.com/en/index.php?f=583" target="_blank" class="linkexternal">Bracket Orders</a> are designed to help limit your loss and lock in a profit by "bracketing" an order with two opposite-side orders. A BUY order is bracketed by a high-side sell limit order and a low-side sell stop order. A SELL order is bracketed by a high-side buy stop order and a low side buy limit order. Note how bracket orders make use of the TWS API's <a class="el" href="order_submission.html#order_attach">Attaching Orders</a> mechanism.</p>
<p>One key thing to keep in mind is to handle the order transmission accurately. Since a Bracket consists of three orders, there is always a risk that at least one of the orders gets filled before the entire bracket is sent. To avoid it, make use of the <a class="el" href="classIBApi_1_1Order.html#aaa1c4f31b9580ee0715edcd78a51cbec">IBApi.Order.Transmit</a> flag. When this flag is set to 'false', the TWS will receive the order but it will not send (transmit) it to the servers. In the example below, the first (parent) and second (takeProfit) orders will be send to the TWS but not transmitted to the servers. When the last child order (stopLoss) is sent however and given that its <a class="el" href="classIBApi_1_1Order.html#aaa1c4f31b9580ee0715edcd78a51cbec">IBApi.Order.Transmit</a> flag is set to true, the TWS will interpret this as a signal to transmit not only its parent order but also the rest of siblings, removing the risks of an accidental execution.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; BracketOrder(<span class="keywordtype">int</span> parentOrderId, <span class="keywordtype">string</span> action, <span class="keywordtype">double</span> quantity, <span class="keywordtype">double</span> limitPrice, </div>
<div class="line">            <span class="keywordtype">double</span> takeProfitLimitPrice, <span class="keywordtype">double</span> stopLossPrice)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//This will be our main or &quot;parent&quot; order</span></div>
<div class="line">            Order parent = <span class="keyword">new</span> Order();</div>
<div class="line">            parent.OrderId = parentOrderId;</div>
<div class="line">            parent.Action = action;</div>
<div class="line">            parent.OrderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">            parent.TotalQuantity = quantity;</div>
<div class="line">            parent.LmtPrice = limitPrice;</div>
<div class="line">            <span class="comment">//The parent and children orders will need this attribute set to false to prevent accidental executions.</span></div>
<div class="line">            <span class="comment">//The LAST CHILD will have it set to true, </span></div>
<div class="line">            parent.Transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            Order takeProfit = <span class="keyword">new</span> Order();</div>
<div class="line">            takeProfit.OrderId = parent.OrderId + 1;</div>
<div class="line">            takeProfit.Action = action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">            takeProfit.OrderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">            takeProfit.TotalQuantity = quantity;</div>
<div class="line">            takeProfit.LmtPrice = takeProfitLimitPrice;</div>
<div class="line">            takeProfit.ParentId = parentOrderId;</div>
<div class="line">            takeProfit.Transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            Order stopLoss = <span class="keyword">new</span> Order();</div>
<div class="line">            stopLoss.OrderId = parent.OrderId + 2;</div>
<div class="line">            stopLoss.Action = action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">            stopLoss.OrderType = <span class="stringliteral">&quot;STP&quot;</span>;</div>
<div class="line">            <span class="comment">//Stop trigger price</span></div>
<div class="line">            stopLoss.AuxPrice = stopLossPrice;</div>
<div class="line">            stopLoss.TotalQuantity = quantity;</div>
<div class="line">            stopLoss.ParentId = parentOrderId;</div>
<div class="line">            <span class="comment">//In this case, the low side order will be the last child being sent. Therefore, it needs to set this attribute to true </span></div>
<div class="line">            <span class="comment">//to activate all its predecessors</span></div>
<div class="line">            stopLoss.Transmit = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">            List&lt;Order&gt; bracketOrder = <span class="keyword">new</span> List&lt;Order&gt;();</div>
<div class="line">            bracketOrder.Add(parent);</div>
<div class="line">            bracketOrder.Add(takeProfit);</div>
<div class="line">            bracketOrder.Add(stopLoss);</div>
<div class="line">            <span class="keywordflow">return</span> bracketOrder;</div>
<div class="line">        }</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">            List&lt;Order&gt; bracket = OrderSamples.BracketOrder(nextOrderId++, <span class="stringliteral">&quot;BUY&quot;</span>, 100, 30, 40, 20);</div>
<div class="line">            <span class="keywordflow">foreach</span> (Order o <span class="keywordflow">in</span> bracket)</div>
<div class="line">                client.placeOrder(o.OrderId, ContractSamples.EuropeanStock(), o);</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; BracketOrder(<span class="keywordtype">int</span> parentOrderId, String action, <span class="keywordtype">double</span> quantity, <span class="keywordtype">double</span> limitPrice, <span class="keywordtype">double</span> takeProfitLimitPrice, <span class="keywordtype">double</span> stopLossPrice) {</div>
<div class="line">        <span class="comment">//This will be our main or &quot;parent&quot; order</span></div>
<div class="line">        Order parent = <span class="keyword">new</span> Order();</div>
<div class="line">        parent.orderId(parentOrderId);</div>
<div class="line">        parent.action(action);</div>
<div class="line">        parent.orderType(<span class="stringliteral">&quot;LMT&quot;</span>);</div>
<div class="line">        parent.totalQuantity(quantity);</div>
<div class="line">        parent.lmtPrice(limitPrice);</div>
<div class="line">        <span class="comment">//The parent and children orders will need this attribute set to false to prevent accidental executions.</span></div>
<div class="line">        <span class="comment">//The LAST CHILD will have it set to true.</span></div>
<div class="line">        parent.transmit(<span class="keyword">false</span>);</div>
<div class="line">        </div>
<div class="line">        Order takeProfit = <span class="keyword">new</span> Order();</div>
<div class="line">        takeProfit.orderId(parent.orderId() + 1);</div>
<div class="line">        takeProfit.action(action.equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>);</div>
<div class="line">        takeProfit.orderType(<span class="stringliteral">&quot;LMT&quot;</span>);</div>
<div class="line">        takeProfit.totalQuantity(quantity);</div>
<div class="line">        takeProfit.lmtPrice(takeProfitLimitPrice);</div>
<div class="line">        takeProfit.parentId(parentOrderId);</div>
<div class="line">        takeProfit.transmit(<span class="keyword">false</span>);</div>
<div class="line">        </div>
<div class="line">        Order stopLoss = <span class="keyword">new</span> Order();</div>
<div class="line">        stopLoss.orderId(parent.orderId() + 2);</div>
<div class="line">        stopLoss.action(action.equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>);</div>
<div class="line">        stopLoss.orderType(<span class="stringliteral">&quot;STP&quot;</span>);</div>
<div class="line">        <span class="comment">//Stop trigger price</span></div>
<div class="line">        stopLoss.auxPrice(stopLossPrice);</div>
<div class="line">        stopLoss.totalQuantity(quantity);</div>
<div class="line">        stopLoss.parentId(parentOrderId);</div>
<div class="line">        <span class="comment">//In this case, the low side order will be the last child being sent. Therefore, it needs to set this attribute to true </span></div>
<div class="line">        <span class="comment">//to activate all its predecessors</span></div>
<div class="line">        stopLoss.transmit(<span class="keyword">true</span>);</div>
<div class="line">        </div>
<div class="line">        List&lt;Order&gt; bracketOrder = <span class="keyword">new</span> ArrayList&lt;Order&gt;();</div>
<div class="line">        bracketOrder.add(parent);</div>
<div class="line">        bracketOrder.add(takeProfit);</div>
<div class="line">        bracketOrder.add(stopLoss);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> bracketOrder;</div>
<div class="line">    }</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line">            <span class="stringliteral">&#39;This will be our main Or &quot;parent&quot; order</span></div>
<div class="line"><span class="stringliteral">            Dim parent As Order = New Order</span></div>
<div class="line"><span class="stringliteral">            parent.OrderId = parentOrderId</span></div>
<div class="line"><span class="stringliteral">            parent.Action = action</span></div>
<div class="line"><span class="stringliteral">            parent.OrderType = &quot;LMT&quot;</span></div>
<div class="line"><span class="stringliteral">            parent.TotalQuantity = quantity</span></div>
<div class="line"><span class="stringliteral">            parent.LmtPrice = limitPrice</span></div>
<div class="line"><span class="stringliteral">            &#39;</span>The parent And children orders will need <span class="keyword">this</span> attribute set to <span class="keyword">false</span> to prevent accidental executions.</div>
<div class="line">            <span class="stringliteral">&#39;The LAST CHILD will have it set to true, </span></div>
<div class="line"><span class="stringliteral">            parent.Transmit = False</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            Dim takeProfit As Order = New Order</span></div>
<div class="line"><span class="stringliteral">            &#39;</span></div>
<div class="line">            takeProfit.OrderId = parent.OrderId + 1</div>
<div class="line"></div>
<div class="line">            If action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) Then takeProfit.Action = <span class="stringliteral">&quot;SELL&quot;</span> Else takeProfit.Action = <span class="stringliteral">&quot;BUY&quot;</span></div>
<div class="line">            takeProfit.OrderType = <span class="stringliteral">&quot;LMT&quot;</span></div>
<div class="line">            takeProfit.TotalQuantity = quantity</div>
<div class="line">            takeProfit.LmtPrice = takeProfitLimitPrice</div>
<div class="line">            takeProfit.ParentId = parentOrderId</div>
<div class="line">            takeProfit.Transmit = False</div>
<div class="line"></div>
<div class="line">            Dim stopLoss As Order = New Order</div>
<div class="line">            stopLoss.OrderId = parent.OrderId + 2</div>
<div class="line">            If action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) Then stopLoss.Action = <span class="stringliteral">&quot;SELL&quot;</span> Else stopLoss.Action = <span class="stringliteral">&quot;BUY&quot;</span></div>
<div class="line">            stopLoss.OrderType = <span class="stringliteral">&quot;STP&quot;</span></div>
<div class="line">            <span class="stringliteral">&#39;Stop trigger price</span></div>
<div class="line"><span class="stringliteral">            stopLoss.AuxPrice = stopLossPrice</span></div>
<div class="line"><span class="stringliteral">            stopLoss.TotalQuantity = quantity</span></div>
<div class="line"><span class="stringliteral">            stopLoss.ParentId = parentOrderId</span></div>
<div class="line"><span class="stringliteral">            &#39;</span>In <span class="keyword">this</span> <span class="keywordflow">case</span>, the low side order will be the last child being sent. Therefore, it needs to set <span class="keyword">this</span> attribute to <span class="keyword">true</span> </div>
<div class="line">            <span class="stringliteral">&#39;to activate all its predecessors</span></div>
<div class="line"><span class="stringliteral">            stopLoss.Transmit = True</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            Dim orders As List(Of Order) = New List(Of Order)</span></div>
<div class="line"><span class="stringliteral">            orders.Add(parent)</span></div>
<div class="line"><span class="stringliteral">            orders.Add(takeProfit)</span></div>
<div class="line"><span class="stringliteral">            orders.Add(stopLoss)</span></div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">        Dim bracket As List(Of Order) = OrderSamples.BracketOrder(increment(nextOrderId), <span class="stringliteral">&quot;BUY&quot;</span>, 100, 30, 40, 20)</div>
<div class="line">        For Each o As Order In bracket</div>
<div class="line">            client.placeOrder(o.OrderId, ContractSamples.EuropeanStock(), o)</div>
<div class="line">        Next</div>
</div><!-- fragment -->  </li>
<li>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OrderSamples::BracketOrder(<span class="keywordtype">int</span> parentOrderId, Order&amp; parent, Order&amp; takeProfit, Order&amp; stopLoss, std::string action, <span class="keywordtype">double</span> quantity, <span class="keywordtype">double</span> limitPrice, <span class="keywordtype">double</span> takeProfitLimitPrice, <span class="keywordtype">double</span> stopLossPrice){</div>
<div class="line">    <span class="comment">//This will be our main or &quot;parent&quot; order</span></div>
<div class="line">    parent.orderId = parentOrderId;</div>
<div class="line">    parent.action = action;</div>
<div class="line">    parent.orderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">    parent.totalQuantity = quantity;</div>
<div class="line">    parent.lmtPrice = limitPrice;</div>
<div class="line">    <span class="comment">//The parent and children orders will need this attribute set to false to prevent accidental executions.</span></div>
<div class="line">    <span class="comment">//The LAST CHILD will have it set to true, </span></div>
<div class="line">    parent.transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    takeProfit.orderId = parent.orderId + 1;</div>
<div class="line">    takeProfit.action = (action == <span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">    takeProfit.orderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">    takeProfit.totalQuantity = quantity;</div>
<div class="line">    takeProfit.lmtPrice = takeProfitLimitPrice;</div>
<div class="line">    takeProfit.parentId = parentOrderId;</div>
<div class="line">    takeProfit.transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    stopLoss.orderId = parent.orderId + 2;</div>
<div class="line">    stopLoss.action = (action == <span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">    stopLoss.orderType = <span class="stringliteral">&quot;STP&quot;</span>;</div>
<div class="line">    <span class="comment">//Stop trigger price</span></div>
<div class="line">    stopLoss.auxPrice = stopLossPrice;</div>
<div class="line">    stopLoss.totalQuantity = quantity;</div>
<div class="line">    stopLoss.parentId = parentOrderId;</div>
<div class="line">    <span class="comment">//In this case, the low side order will be the last child being sent. Therefore, it needs to set this attribute to true </span></div>
<div class="line">    <span class="comment">//to activate all its predecessors</span></div>
<div class="line">    stopLoss.transmit = <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> ... <div class="fragment"><div class="line">    OrderSamples::BracketOrder(m_orderId++, parent, takeProfit, stopLoss, <span class="stringliteral">&quot;BUY&quot;</span>, 100, 30, 40, 20);</div>
<div class="line">    m_pClient-&gt;placeOrder(parent.orderId, ContractSamples::EuropeanStock(), parent);</div>
<div class="line">    m_pClient-&gt;placeOrder(takeProfit.orderId, ContractSamples::EuropeanStock(), takeProfit);</div>
<div class="line">    m_pClient-&gt;placeOrder(stopLoss.orderId, ContractSamples::EuropeanStock(), stopLoss);</div>
</div><!-- fragment -->  </li>
</ul>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">This website uses cookies. By navigating through it you agree to the use of cookies. Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
</body>
</html>
