<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>TWS API: Bracket Orders</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="https://www.interactivebrokers.com/favicon.ico" rel="shortcut icon">
<script>
$(document).ready(function(){
    $("ul#tabs li").click(function(e){
        if (!$(this).hasClass("active")) {
            var tabNum = $(this).index();
            var nthChild = tabNum+1;
            $("ul#tabs li.active").removeClass("active");
            $(this).addClass("active");
            $("ul#tab li.active").removeClass("active");
            $("ul#tab li:nth-child("+nthChild+")").addClass("active");
        }
    });
});
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ib_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" style="background-color:black;">
<table cellspacing="0" cellpadding="0" >
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="nav_iblogo.png"/></td>
  <td style="padding: 0 0 0 1em;">
   <ul id="tabs"><li class="active">C#</li><li>Java</li><li>VB</li><li>C++</li></ul>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('bracket.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Bracket Orders </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://www.interactivebrokers.com/en/index.php?f=583" target="_blank" class="linkexternal">Bracket Orders</a> are designed to help limit your loss and lock in a profit by "bracketing" an order with two opposite-side orders. A BUY order is bracketed by a high-side sell limit order and a low-side sell stop order. A SELL order is bracketed by a high-side buy stop order and a low side buy limit order</p>
<h1><a class="anchor" id="bracket_create"></a>
Creating</h1>
<p>One key thing to keep in mind is to handle the order transmission accurately. Since a Bracket consists of three orders, there is always a risk that at least one of the orders gets filled before the entire bracket is sent. To avoid it, make use of the <a class="el" href="classIBApi_1_1Order.html#aaa1c4f31b9580ee0715edcd78a51cbec">IBApi.Order.Transmit</a> flag. When this flag is set to 'false', the TWS will receive the order but it will not send (transmit) it to the servers. In the example below, the first (parent) and second (takeProfit) orders will be send to the TWS but not transmitted to the servers. When the last child order (stopLoss) is sent however and given that its <a class="el" href="classIBApi_1_1Order.html#aaa1c4f31b9580ee0715edcd78a51cbec">IBApi.Order.Transmit</a> flag is set to true, the TWS will interpret this as a signal to transmit not only its parent order but also the rest of siblings, removing the risks of an accidental execution.</p>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Order&gt; BracketOrder(<span class="keywordtype">int</span> parentOrderId, <span class="keywordtype">string</span> action, <span class="keywordtype">double</span> quantity, <span class="keywordtype">double</span> limitPrice, </div>
<div class="line">            <span class="keywordtype">double</span> takeProfitLimitPrice, <span class="keywordtype">double</span> stopLossPrice)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//This will be our main or &quot;parent&quot; order</span></div>
<div class="line">            Order parent = <span class="keyword">new</span> Order();</div>
<div class="line">            parent.OrderId = parentOrderId;</div>
<div class="line">            parent.Action = action;</div>
<div class="line">            parent.OrderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">            parent.TotalQuantity = quantity;</div>
<div class="line">            parent.LmtPrice = limitPrice;</div>
<div class="line">            <span class="comment">//The parent and children orders will need this attribute set to false to prevent accidental executions.</span></div>
<div class="line">            <span class="comment">//The LAST CHILD will have it set to true, </span></div>
<div class="line">            parent.Transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            Order takeProfit = <span class="keyword">new</span> Order();</div>
<div class="line">            takeProfit.OrderId = parent.OrderId + 1;</div>
<div class="line">            takeProfit.Action = action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">            takeProfit.OrderType = <span class="stringliteral">&quot;LMT&quot;</span>;</div>
<div class="line">            takeProfit.TotalQuantity = quantity;</div>
<div class="line">            takeProfit.LmtPrice = takeProfitLimitPrice;</div>
<div class="line">            takeProfit.ParentId = parentOrderId;</div>
<div class="line">            takeProfit.Transmit = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">            Order stopLoss = <span class="keyword">new</span> Order();</div>
<div class="line">            stopLoss.OrderId = parent.OrderId + 2;</div>
<div class="line">            stopLoss.Action = action.Equals(<span class="stringliteral">&quot;BUY&quot;</span>) ? <span class="stringliteral">&quot;SELL&quot;</span> : <span class="stringliteral">&quot;BUY&quot;</span>;</div>
<div class="line">            stopLoss.OrderType = <span class="stringliteral">&quot;STP&quot;</span>;</div>
<div class="line">            <span class="comment">//Stop trigger price</span></div>
<div class="line">            stopLoss.AuxPrice = stopLossPrice;</div>
<div class="line">            stopLoss.TotalQuantity = quantity;</div>
<div class="line">            stopLoss.ParentId = parentOrderId;</div>
<div class="line">            <span class="comment">//In this case, the low side order will be the last child being sent. Therefore, it needs to set this attribute to true </span></div>
<div class="line">            <span class="comment">//to activate all its predecessors</span></div>
<div class="line">            stopLoss.Transmit = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">            List&lt;Order&gt; bracketOrder = <span class="keyword">new</span> List&lt;Order&gt;();</div>
<div class="line">            bracketOrder.Add(parent);</div>
<div class="line">            bracketOrder.Add(takeProfit);</div>
<div class="line">            bracketOrder.Add(stopLoss);</div>
<div class="line">            <span class="keywordflow">return</span> bracketOrder;</div>
<div class="line">        }</div>
</div><!-- fragment -->  </li>
<li>
</li>
<li>
</li>
<li>
</li>
</ul>
<h1><a class="anchor" id="bracket_submit"></a>
Submitting</h1>
<ul id="tab">
<li class="active">
<div class="fragment"><div class="line">            List&lt;Order&gt; bracket = OrderSamples.BracketOrder(nextOrderId++, <span class="stringliteral">&quot;BUY&quot;</span>, 100, 30, 40, 20);</div>
<div class="line">            <span class="keywordflow">foreach</span> (Order o <span class="keywordflow">in</span> bracket)</div>
<div class="line">                client.placeOrder(o.OrderId, ContractSamples.EuropeanStock(), o);</div>
</div><!-- fragment -->  </li>
<li>
</li>
<li>
</li>
<li>
</li>
</ul>
<p><br/>
<br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">WARNING: This site is under construction and as such pending revision and official approval from Interactive Brokers - Copyright Interactive Brokers 2016 </li>
  </ul>
</div>
</body>
</html>
